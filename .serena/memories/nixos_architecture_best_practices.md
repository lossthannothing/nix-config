# NixOS 配置分层架构最佳实践

## 核心原则
1. **角色-配置文件-组件模式**：机器有角色，角色包含配置文件，配置文件包含组件
2. **避免条件导入**：导入所有模块，使用 enable 选项控制功能
3. **硬件配置分离**：hardware-configuration.nix 存储机器特定配置
4. **平台特定模块化**：WSL、VM、实体机等平台配置独立

## 分层结构建议
- **核心层**：所有平台通用配置（Nix设置、时区、语言）
- **平台层**：平台特定配置（WSL、VM、实体机、Darwin）
- **功能层**：可选功能模块（桌面环境、开发工具）
- **主机层**：主机特定配置（主机名、硬件配置）

## 关键发现
- 当前VM配置混合了桌面环境配置，应分离
- WSL配置已经相对独立，可作为模板
- 缺少实体机硬件配置支持
- 需要更好的功能模块组织